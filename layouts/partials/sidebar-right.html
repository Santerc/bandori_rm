<!-- 1. 知识库专属侧边栏 (WIKI MODE) -->
{{ if eq .Section "wiki" }}
    
    <!-- 知识库目录 (仅在具体的知识库子目录或文章页显示) -->
    {{ if ne .RelPermalink "/wiki/" }}
    <div class="widget">
        <div class="widget-title">// {{ .CurrentSection.Title | upper }}</div>
        <ul class="menu-list" style="max-height: 60vh; overflow-y: auto;">
            <!-- 获取当前 Section 下的所有页面 -->
            {{ range .CurrentSection.Pages.ByWeight }}
            <li>
                <a href="{{ .Permalink }}" class="{{ if eq . $ }}active{{ end }}" style="
                    display: block; 
                    padding: 6px 0; 
                    font-size: 0.95rem;
                    {{ if eq . $ }}color: var(--primary); font-weight: bold;{{ end }}
                ">
                    {{ .Title }}
                </a>
            </li>
            {{ end }}
        </ul>
    </div>
    {{ end }}

    <!-- 如果是文章页，显示当前页目录 -->
    {{ if .IsPage }}
    <div class="widget toc-widget">
        <div class="widget-title">// PAGE_INDEX</div>
        <nav id="TableOfContents">
            {{ .TableOfContents }}
        </nav>
    </div>
    {{ end }}

    <!-- [增加式修改] 保留通用模块，但放在下方 -->
    
    <!-- 分类归档 -->
    <div class="widget">
        <div class="widget-title">// DATABASE</div>
        <ul class="menu-list">
            {{ range .Site.Taxonomies.categories }}
            <li>
                <a href="{{ .Page.Permalink }}">
                    {{ .Page.Title | upper }} 
                    <span>[{{ .Count }}]</span>
                </a>
            </li>
            {{ end }}
        </ul>
    </div>

<!-- 2. 普通博客侧边栏 (BLOG MODE) -->
{{ else }}

    {{ if .IsPage }}
        <!-- 文章目录 -->
        <div class="widget toc-widget">
            <div class="widget-title">// INDEX_PROTOCOL</div>
            <nav id="TableOfContents">
                {{ .TableOfContents }}
            </nav>
        </div>
    {{ else }}
        <!-- 热门标签 -->
        <div class="widget">
            <div class="widget-title">// HOT_TAGS</div>
            <div class="tag-cloud">
                {{ range first 15 .Site.Taxonomies.tags.ByCount }}
                <a href="{{ .Page.Permalink }}" title="{{ .Count }} posts">
                    #{{ .Page.Title | upper }}
                </a>
                {{ end }}
            </div>
        </div>
    {{ end }}

    <!-- 分类归档 -->
    <div class="widget">
        <div class="widget-title">// DATABASE</div>
        <ul class="menu-list">
            {{ range .Site.Taxonomies.categories }}
            <li>
                <a href="{{ .Page.Permalink }}">
                    {{ .Page.Title | upper }} 
                    <span>[{{ .Count }}]</span>
                </a>
            </li>
            {{ end }}
        </ul>
    </div>

    <!-- 最新文章 -->
    <div class="widget">
        <div class="widget-title">// LATEST_LOGS</div>
        <ul class="recent-posts-list">
            {{ range first 5 (where .Site.RegularPages "Section" "posts") }}
            <li>
                <a href="{{ .Permalink }}">{{ .Title }}</a>
                <span class="date">{{ .Date.Format "01-02" }}</span>
            </li>
            {{ end }}
        </ul>
    </div>

{{ end }}
